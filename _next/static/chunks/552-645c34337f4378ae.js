"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[552],{911:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5893),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7294);let CategoryList=param=>{let{className,categories,totalEntries,selectCategory,selectSite}=param,[currentCategory,setCurrentCategory]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)();return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("aside",{className:"w-full sm:w-1/3 xl:w-1/5 flex-shrink-0 p-6 sm:overflow-auto overscroll-contain ".concat(className),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h1",{className:"font-serif",children:"Feeds"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("h2",{className:"cursor-pointer",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"font-serif no-underline hover:underline mr-2",onClick:()=>selectSite&&selectSite("all"),children:"All sites"}),null!==totalEntries&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("small",{className:"text-sm font-light",children:["(",totalEntries,")"]})]}),categories.map(category=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("h2",{className:"cursor-pointer",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"font-serif no-underline hover:underline mr-2",onClick:()=>setCurrentCategory(category.title),children:category.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("small",{className:"text-sm font-light",children:["(",category.totalEntries,")"]})]}),category.title===currentCategory&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("ul",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("li",{className:"cursor-pointer",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"font-serif no-underline hover:underline",onClick:()=>selectCategory&&selectCategory(currentCategory),children:"All sites"})}),category.sites.map(site=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("li",{className:"cursor-pointer",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"font-serif no-underline hover:underline mr-2",onClick:()=>selectSite&&selectSite(site.key),children:site.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("small",{className:"text-sm font-light",children:["(",site.totalEntries,")"]})]},site.key))]})]},category.title)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"pb-8"})]})};__webpack_exports__.Z=CategoryList},9451:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5893),date_fns__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2125),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7294);let Entry=param=>{let{className,content,selectBack}=param,element=null;return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{element&&element.scrollTo(0,0)},[content]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("article",{ref(article){element=article},className:"pb-4 max-w-full break-words flex-grow p-6 xl:overflow-auto overscroll-contain ".concat(className),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"cursor-pointer xl:hidden",onClick:selectBack,children:"← Back"}),content&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h2",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"font-serif font-bold no-underline hover:underline",href:content.url,target:"_blank",children:content.title})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"xl:hidden",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("strong",{children:content.siteTitle}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("span",{children:[", ",(0,date_fns__WEBPACK_IMPORTED_MODULE_2__.Z)(1e3*content.timestamp,new Date)]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{dangerouslySetInnerHTML:{__html:content.content}})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"pb-8"})]})};__webpack_exports__.Z=Entry},6724:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5893),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7294),date_fns_formatDistance__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2125),_storage__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(386);let EntryItem=param=>{let{index,entry,selectedEntryHash,selectEntry,selectSite,entryRef}=param;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{ref:entryRef,className:"rounded px-4 ".concat(selectedEntryHash===entry.key&&"bg-gray-200"||"").trim(),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h3",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("a",{className:"font-serif no-underline hover:underline cursor-pointer",onClick:()=>selectEntry&&selectEntry(entry.key),children:[index+1,". ",entry.title]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("small",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"cursor-pointer",onClick:()=>selectSite&&selectSite(entry.site.key),children:entry.site.title}),entry.timestamp&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("span",{children:[", ",(0,date_fns_formatDistance__WEBPACK_IMPORTED_MODULE_3__.Z)(1e3*entry.timestamp,new Date)]})]})]})},EntryList=param=>{let{className,basePath,locationState,selectEntry,selectSite,selectBack}=param,[pageState,setPageState]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)("loading"),[currentCategoryOrSite,setCurrentCategoryOrSite]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),[entries,setEntries]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]),[totalEntry,setTotalEntry]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0),[selectedEntryHash,setSelectedEntryHash]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),[page,setPage]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0),nextBatchEntry=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(),element=null,loadEntries=async function(basePath,locationState){let page=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,worker=await (0,_storage__WEBPACK_IMPORTED_MODULE_2__.Sl)((0,_storage__WEBPACK_IMPORTED_MODULE_2__.c0)(basePath),basePath);switch(locationState.type){case"category":{let category=locationState.category,[entries,totalEntry]=await Promise.all([(0,_storage__WEBPACK_IMPORTED_MODULE_2__.cA)(worker,category,page),(0,_storage__WEBPACK_IMPORTED_MODULE_2__.pW)(worker,category)]);return{entries,totalEntry}}case"site":{let{siteKey}=locationState,[entries1,totalEntry1]="all"===siteKey?await Promise.all([(0,_storage__WEBPACK_IMPORTED_MODULE_2__.C0)(worker,page),(0,_storage__WEBPACK_IMPORTED_MODULE_2__.M8)(worker)]):await Promise.all([(0,_storage__WEBPACK_IMPORTED_MODULE_2__.V3)(worker,siteKey,page),(0,_storage__WEBPACK_IMPORTED_MODULE_2__.J4)(worker,siteKey)]);return{entries:entries1,totalEntry:totalEntry1}}case"entry":let{parent}=locationState,{key}=parent;if("category"===parent.type){let[entries2,totalEntry2]=await Promise.all([(0,_storage__WEBPACK_IMPORTED_MODULE_2__.cA)(worker,key,page),(0,_storage__WEBPACK_IMPORTED_MODULE_2__.pW)(worker,key)]);return{entries:entries2,totalEntry:totalEntry2}}let[entries3,totalEntry3]="all"===key?await Promise.all([(0,_storage__WEBPACK_IMPORTED_MODULE_2__.C0)(worker,page),(0,_storage__WEBPACK_IMPORTED_MODULE_2__.M8)(worker)]):await Promise.all([(0,_storage__WEBPACK_IMPORTED_MODULE_2__.V3)(worker,key,page),(0,_storage__WEBPACK_IMPORTED_MODULE_2__.J4)(worker,key)]);return{entries:entries3,totalEntry:totalEntry3}}},loadNextPage=async page=>{if("loading"===pageState||entries.length===totalEntry)return;let{entries:newEntries}=await loadEntries(basePath,locationState,page);setEntries(entries.concat(newEntries))};(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{switch(locationState.type){case"category":if(currentCategoryOrSite===locationState.category)return;return setCurrentCategoryOrSite(locationState.category);case"site":if(currentCategoryOrSite===locationState.siteKey)return;return setCurrentCategoryOrSite(locationState.siteKey)}},[locationState]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{element&&(async element=>{let{entries,totalEntry}=await loadEntries(basePath,locationState);setPageState("loaded"),setEntries(entries),setTotalEntry(totalEntry),setPage(0),element.scrollTo(0,0)})(element)},[currentCategoryOrSite]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!(null==nextBatchEntry?void 0:nextBatchEntry.current))return;let observer=new IntersectionObserver(entries=>{let[entry]=entries;"loading"!==pageState&&entry.isIntersecting&&(setPageState("loading"),loadNextPage(page+1).then(()=>{setPage(current=>current+1),setPageState("loaded")}))});return observer.observe(nextBatchEntry.current),()=>{observer.disconnect()}},[nextBatchEntry,totalEntry,entries]);let parentType="entry"===locationState.type?locationState.parent.type:locationState.type,parentKey="entry"===locationState.type?locationState.parent.key:"category"===locationState.type?locationState.category:locationState.siteKey;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("section",{ref(section){element=section},className:"pb-4 w-full sm:w-2/3 xl:w-2/6 flex-shrink-0 p-6 overflow-auto overscroll-contain ".concat(className),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{className:"cursor-pointer sm:hidden",onClick:selectBack,children:"← Back"}),entries.map((entry,index)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(EntryItem,{index:index,entry:entry,selectedEntryHash:selectedEntryHash,async selectEntry(entryKey){setSelectedEntryHash(entryKey),selectEntry&&selectEntry(parentType,parentKey,entryKey)},selectSite:selectSite,entryRef:entries.length-5===index&&entries.length<totalEntry?nextBatchEntry:null},entry.key)),0===entries.length&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h3",{children:"No contents"})},"none"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"pb-8"})]})};__webpack_exports__.Z=EntryList},5413:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5893);__webpack_require__(7294);var next_head__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9008),next_head__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(next_head__WEBPACK_IMPORTED_MODULE_2__);let Header=()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(next_head__WEBPACK_IMPORTED_MODULE_2___default(),{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("title",{children:"Feeds"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("meta",{charSet:"utf-8"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("meta",{httpEquiv:"X-UA-Compatible",content:"IE=Edge"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("meta",{name:"description",content:"Feeds Aggregator"})]});__webpack_exports__.Z=Header},386:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{C0:function(){return getAllEntries},CP:function(){return getCategories},J4:function(){return countSiteEntries},L5:function(){return getContent},M8:function(){return countAllEntries},Sl:function(){return getWorker},V3:function(){return getSiteEntries},c0:function(){return getDatabaseConfig},cA:function(){return getCategoryEntries},pW:function(){return countCategoryEntries}});var sql_js_httpvfs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2891);let worker=null;async function getWorker(config,basePath){return worker||(worker=await (0,sql_js_httpvfs__WEBPACK_IMPORTED_MODULE_0__.createDbWorker)([config],"".concat(basePath,"/sqlite.worker.js"),"".concat(basePath,"/sql-wasm.wasm"))),worker}function getDatabaseConfig(basePath){return{from:"inline",config:{serverMode:"full",requestChunkSize:4096,url:"".concat(basePath,"/data.sqlite3")}}}async function getCategories(worker){let categories=await worker.db.query("select category, siteKey, siteTitle from SiteCategories"),categoryEntryCounts=(await worker.db.query("select category, count(*) as totalEntries from EntryCategories group by category")).reduce((out,row)=>(out[row.category]=row.totalEntries,out),{}),siteEntryCounts=(await worker.db.query("select siteKey, count(*) as totalEntries from EntryCategories group by siteKey;")).reduce((out,row)=>(out[row.siteKey]=row.totalEntries,out),{}),map=categories.reduce((map,item)=>(map[item.category]||(map[item.category]={totalEntries:categoryEntryCounts[item.category],sites:[]}),map[item.category].sites.push({key:item.siteKey,title:item.siteTitle,totalEntries:siteEntryCounts[item.siteKey]}),map),{});return Object.keys(map).map(title=>({title,sites:map[title].sites,totalEntries:map[title].totalEntries}))}async function getCategoryEntries(worker,category){let page=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,list=await worker.db.query("select * from EntryCategories where category = ? and entryContentTime is not null order by entryContentTime desc limit ? offset ?",[category,30,30*page]);return list.map(item=>({key:item.entryKey,title:item.entryTitle,site:{key:item.siteKey,title:item.siteTitle},timestamp:item.entryContentTime}))}async function getSiteEntries(worker,siteKey){let page=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,list=await worker.db.query("select entryKey, siteKey, siteTitle, entryTitle, entryContentTime from EntryCategories where siteKey = ? order by entryContentTime desc limit ? offset ?",[siteKey,30,30*page]);return list.map(item=>({key:item.entryKey,title:item.entryTitle,site:{key:item.siteKey,title:item.siteTitle},timestamp:item.entryContentTime}))}async function countAllEntries(worker){let count=await worker.db.query("select count(*) as total from EntryCategories");return count[0].total}async function countSiteEntries(worker,siteKey){let count=await worker.db.query("select count(*) as total from EntryCategories where siteKey = ?",[siteKey]);return count[0].total}async function countCategoryEntries(worker,category){let count=await worker.db.query("select count(*) as total from EntryCategories where category = ?",[category]);return count[0].total}async function getAllEntries(worker){let page=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,list=await worker.db.query("select entryKey, siteKey, siteTitle, entryTitle, entryContentTime from EntryCategories where entryContentTime is not null order by entryContentTime desc limit ? offset ?",[30,30*page]);return list.map(item=>({key:item.entryKey,title:item.entryTitle,site:{key:item.siteKey,title:item.siteTitle},timestamp:item.entryContentTime}))}async function getContent(worker,key){let entry=await worker.db.query("select title, content, url, siteKey, siteTitle, contentTime as timestamp from Entries where key = ?",[key]);return 0===entry.length?null:entry[0]}},3047:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{BJ:function(){return categoriesClassName},Dq:function(){return articleClassName},EH:function(){return entriesClassName},GJ:function(){return locationController},hX:function(){return parseLocation}}),__webpack_require__(7294);var _storage__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(386);let articleClassName=pageState=>"article"===pageState?"block":"hidden xl:block",entriesClassName=pageState=>{switch(pageState){case"article":return"hidden xl:block";case"entries":return"block";default:return"hidden sm:block"}},categoriesClassName=pageState=>{switch(pageState){case"article":return"hidden xl:block";case"entries":return"hidden sm:block";default:return"block"}},parseLocation=url=>{let parts=url.split("/");if(parts.shift(),![2,4].includes(parts.length))return null;if(2===parts.length){if(!parts[1].trim())return null;switch(parts[0]){case"categories":return{type:"category",category:parts[1]};case"sites":return{type:"site",siteKey:parts[1]};default:return null}}return parts[3].trim()&&["categories","sites"].includes(parts[0])&&"entries"===parts[2]?{type:"entry",entryKey:parts[3],parent:{type:"categories"===parts[0]?"category":"site",key:parts[1]}}:null},locationController=async(locationState,basePath,setContent,setPageState)=>{if(!locationState)return null;let worker=await (0,_storage__WEBPACK_IMPORTED_MODULE_1__.Sl)((0,_storage__WEBPACK_IMPORTED_MODULE_1__.c0)(basePath),basePath);switch(locationState.type){case"category":case"site":setContent(null),setPageState("entries");return;case"entry":{let{entryKey}=locationState,content=await (0,_storage__WEBPACK_IMPORTED_MODULE_1__.L5)(worker,entryKey);if(!content)return;setContent(content),setPageState("article");return}}}}}]);