"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[19],{8217:function(e,t,s){var r=s(5893),i=s(7294);let n=e=>{let{className:t,categories:s,totalEntries:n,selectCategory:a,selectSite:l}=e,[o,c]=(0,i.useState)();return(0,r.jsxs)("aside",{className:"w-full sm:w-1/3 xl:w-1/5 flex-shrink-0 p-6 sm:overflow-auto overscroll-contain ".concat(t),children:[(0,r.jsx)("h1",{className:"font-serif",children:"Feeds"}),(0,r.jsxs)("h2",{className:"cursor-pointer",children:[(0,r.jsx)("a",{className:"font-serif no-underline hover:underline mr-2",onClick:()=>l&&l("all"),children:"All sites"}),null!==n&&(0,r.jsxs)("small",{className:"text-sm font-light",children:["(",n,")"]})]}),s.map(e=>(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("h2",{className:"cursor-pointer",children:[(0,r.jsx)("a",{className:"font-serif no-underline hover:underline mr-2",onClick:()=>c(e.title),children:e.title}),(0,r.jsxs)("small",{className:"text-sm font-light",children:["(",e.totalEntries,")"]})]}),e.title===o&&(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{className:"cursor-pointer",children:(0,r.jsx)("a",{className:"font-serif no-underline hover:underline",onClick:()=>a&&a(o),children:"All sites"})}),e.sites.map(e=>(0,r.jsxs)("li",{className:"cursor-pointer",children:[(0,r.jsx)("a",{className:"font-serif no-underline hover:underline mr-2",onClick:()=>l&&l(e.key),children:e.title}),(0,r.jsxs)("small",{className:"text-sm font-light",children:["(",e.totalEntries,")"]})]},e.key))]})]},e.title)),(0,r.jsx)("div",{className:"pb-8"})]})};t.Z=n},5371:function(e,t,s){var r=s(5893),i=s(2125),n=s(7294);let a=e=>{let{className:t,content:s,selectBack:a}=e,l=null;return(0,n.useEffect)(()=>{l&&l.scrollTo(0,0)},[s]),(0,r.jsxs)("article",{ref:e=>{l=e},className:"pb-4 max-w-full break-words flex-grow p-6 xl:overflow-auto overscroll-contain ".concat(t),children:[(0,r.jsx)("a",{className:"cursor-pointer xl:hidden",onClick:a,children:"← Back"}),s&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{children:(0,r.jsx)("a",{className:"font-serif font-bold no-underline hover:underline",href:s.url,target:"_blank",children:s.title})}),(0,r.jsxs)("div",{className:"xl:hidden",children:[(0,r.jsx)("strong",{children:s.siteTitle}),(0,r.jsxs)("span",{children:[", ",(0,i.Z)(1e3*s.timestamp,new Date)]})]}),(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:s.content}})]}),(0,r.jsx)("div",{className:"pb-8"})]})};t.Z=a},850:function(e,t,s){var r=s(5893),i=s(2125),n=s(7294),a=s(6456);let l=e=>{let{index:t,entry:s,selectedEntryHash:n,selectEntry:a,selectSite:l,entryRef:o}=e;return(0,r.jsxs)("div",{ref:o,className:"rounded px-4 ".concat(n===s.key&&"bg-gray-200"||"").trim(),children:[(0,r.jsx)("h3",{children:(0,r.jsxs)("a",{className:"font-serif no-underline hover:underline cursor-pointer",onClick:()=>a&&a(s.key),children:[t+1,". ",s.title]})}),(0,r.jsxs)("small",{children:[(0,r.jsx)("a",{className:"cursor-pointer",onClick:()=>l&&l(s.site.key),children:s.site.title}),s.timestamp&&(0,r.jsxs)("span",{children:[", ",(0,i.Z)(1e3*s.timestamp,new Date)]})]})]})},o=e=>{let{className:t,basePath:s,locationState:i,selectEntry:o,selectSite:c,selectBack:u}=e,[h,y]=(0,n.useState)("loading"),[d,g]=(0,n.useState)(""),[m,f]=(0,n.useState)([]),[w,E]=(0,n.useState)(0),[p,k]=(0,n.useState)(""),[j,x]=(0,n.useState)(0),b=(0,n.useRef)(),C=null,v=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(0,a.c)(e);switch(t.type){case"category":{let e=t.category,[i,n]=await Promise.all([r.getCategoryEntries(e,s),r.countCategoryEntries(e)]);return{entries:i,totalEntry:n}}case"site":{let{siteKey:e}=t,[i,n]="all"===e?await Promise.all([r.getAllEntries(s),r.countAllEntries()]):await Promise.all([r.getSiteEntries(e,s),r.countSiteEntries(e)]);return{entries:i,totalEntry:n}}case"entry":let{parent:i}=t,{key:n}=i;if("category"===i.type){let[e,t]=await Promise.all([r.getCategoryEntries(n,s),r.countCategoryEntries(n)]);return{entries:e,totalEntry:t}}let[l,o]="all"===n?await Promise.all([r.getAllEntries(s),r.countAllEntries()]):await Promise.all([r.getSiteEntries(n,s),r.countSiteEntries(n)]);return{entries:l,totalEntry:o}}},T=async e=>{if("loading"===h||m.length===w)return;let{entries:t}=await v(s,i,e);f(m.concat(t))};(0,n.useEffect)(()=>{switch(i.type){case"category":if(d===i.category)return;return g(i.category);case"site":if(d===i.siteKey)return;return g(i.siteKey)}},[i]),(0,n.useEffect)(()=>{C&&(async e=>{let{entries:t,totalEntry:r}=await v(s,i);y("loaded"),f(t),E(r),x(0),e.scrollTo(0,0)})(C)},[d]),(0,n.useEffect)(()=>{if(!(null==b?void 0:b.current))return;let e=new IntersectionObserver(e=>{let[t]=e;"loading"!==h&&t.isIntersecting&&(y("loading"),T(j+1).then(()=>{x(e=>e+1),y("loaded")}))});return e.observe(b.current),()=>{e.disconnect()}},[b,w,m]);let N="entry"===i.type?i.parent.type:i.type,K="entry"===i.type?i.parent.key:"category"===i.type?i.category:i.siteKey;return(0,r.jsxs)("section",{ref:e=>{C=e},className:"pb-4 w-full sm:w-2/3 xl:w-2/6 flex-shrink-0 p-6 overflow-auto overscroll-contain ".concat(t),children:[(0,r.jsx)("a",{className:"cursor-pointer sm:hidden",onClick:u,children:"← Back"}),m.map((e,t)=>(0,r.jsx)(l,{index:t,entry:e,selectedEntryHash:p,selectEntry:async e=>{k(e),o&&o(N,K,e)},selectSite:c,entryRef:m.length-5===t&&m.length<w?b:null},e.key)),0===m.length&&(0,r.jsx)("div",{children:(0,r.jsx)("h3",{children:"No contents"})},"none"),(0,r.jsx)("div",{className:"pb-8"})]})};t.Z=o},5090:function(e,t,s){var r=s(5893);s(7294);var i=s(9008),n=s.n(i);let a=()=>(0,r.jsxs)(n(),{children:[(0,r.jsx)("title",{children:"Feeds"}),(0,r.jsx)("meta",{charSet:"utf-8"}),(0,r.jsx)("meta",{httpEquiv:"X-UA-Compatible",content:"IE=Edge"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("meta",{name:"description",content:"Feeds Aggregator"})]});t.Z=a},6456:function(e,t,s){s.d(t,{c:function(){return o}});class r{async getCategories(){let e=await fetch("".concat(this.basePath,"/categories.json"));if(200!==e.status)throw Error("Fail to load categories");let t=await e.json();return t.map(e=>({title:e.name,totalEntries:e.totalEntries,sites:e.sites.map(e=>({key:e.siteHash,title:e.title,totalEntries:e.totalEntries}))}))}async getCategoryEntries(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=await fetch("".concat(this.basePath,"/categories/").concat(e,".json"));if(200!==t.status)throw Error("Fail to load category entries");let s=await t.json();return s.map(e=>({key:e.entryHash,title:e.title,site:{key:e.siteHash,title:e.siteTitle},timestamp:Math.floor(e.date/1e3)}))}async getSiteEntries(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=await fetch("".concat(this.basePath,"/sites/").concat(e,".json"));if(200!==t.status)throw Error("Fail to load site entries");let s=await t.json(),r=s.entries;return r.map(e=>({key:e.entryHash,title:e.title,site:{key:e.siteHash,title:e.siteTitle},timestamp:Math.floor(e.date/1e3)}))}async countAllEntries(){let e=await fetch("".concat(this.basePath,"/categories.json"));if(200!==e.status)throw Error("Fail to load count all entries");let t=await e.json();return t.reduce((e,t)=>e+t.totalEntries,0)}async countSiteEntries(e){let t=await fetch("".concat(this.basePath,"/sites/").concat(e,".json"));if(200!==t.status)throw Error("Fail to load site entries");let s=await t.json(),r=s.entries;return r.length}async countCategoryEntries(e){let t=await fetch("".concat(this.basePath,"/categories/").concat(e,".json"));if(200!==t.status)throw Error("Fail to load category entries");let s=await t.json();return s.length}async getAllEntries(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=await fetch("".concat(this.basePath,"/all.json"));if(200!==e.status)throw Error("Fail to load all entries");let t=await e.json();return t.map(e=>({key:e.entryHash,title:e.title,site:{key:e.siteHash,title:e.siteTitle},timestamp:Math.floor(e.date/1e3)}))}async getContent(e){let t=await fetch("".concat(this.basePath,"/entries/").concat(e,".json"));if(200!==t.status)throw Error("Fail to load content");let s=await t.json();return{title:s.title,content:s.content,url:s.link,siteKey:s.siteHash,siteTitle:s.siteTitle,timestamp:Math.floor(s.date/1e3)}}constructor(e){this.basePath="".concat(e,"/data")}}var i=s(2891);class n{async getWorker(e,t){return this.worker||(this.worker=await (0,i.createDbWorker)([e],"".concat(t,"/sqlite.worker.js"),"".concat(t,"/sql-wasm.wasm"))),this.worker}async getCategories(){let e=await this.getWorker(this.config,this.basePath),t=await e.db.query("select category, siteKey, siteTitle from SiteCategories"),s=(await e.db.query("select category, count(*) as totalEntries from EntryCategories group by category")).reduce((e,t)=>(e[t.category]=t.totalEntries,e),{}),r=(await e.db.query("select siteKey, count(*) as totalEntries from EntryCategories group by siteKey;")).reduce((e,t)=>(e[t.siteKey]=t.totalEntries,e),{}),i=t.reduce((e,t)=>(e[t.category]||(e[t.category]={totalEntries:s[t.category],sites:[]}),e[t.category].sites.push({key:t.siteKey,title:t.siteTitle,totalEntries:r[t.siteKey]}),e),{});return Object.keys(i).map(e=>({title:e,sites:i[e].sites,totalEntries:i[e].totalEntries}))}async getCategoryEntries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=await this.getWorker(this.config,this.basePath),r=await s.db.query("select * from EntryCategories where category = ? and entryContentTime is not null order by entryContentTime desc limit ? offset ?",[e,30,30*t]);return r.map(e=>({key:e.entryKey,title:e.entryTitle,site:{key:e.siteKey,title:e.siteTitle},timestamp:e.entryContentTime}))}async getSiteEntries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=await this.getWorker(this.config,this.basePath),r=await s.db.query("select entryKey, siteKey, siteTitle, entryTitle, entryContentTime from EntryCategories where siteKey = ? order by entryContentTime desc limit ? offset ?",[e,30,30*t]);return r.map(e=>({key:e.entryKey,title:e.entryTitle,site:{key:e.siteKey,title:e.siteTitle},timestamp:e.entryContentTime}))}async countAllEntries(){let e=await this.getWorker(this.config,this.basePath),t=await e.db.query("select count(*) as total from EntryCategories");return t[0].total}async countSiteEntries(e){let t=await this.getWorker(this.config,this.basePath),s=await t.db.query("select count(*) as total from EntryCategories where siteKey = ?",[e]);return s[0].total}async countCategoryEntries(e){let t=await this.getWorker(this.config,this.basePath),s=await t.db.query("select count(*) as total from EntryCategories where category = ?",[e]);return s[0].total}async getAllEntries(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=await this.getWorker(this.config,this.basePath),s=await t.db.query("select entryKey, siteKey, siteTitle, entryTitle, entryContentTime from EntryCategories where entryContentTime is not null order by entryContentTime desc limit ? offset ?",[30,30*e]);return s.map(e=>({key:e.entryKey,title:e.entryTitle,site:{key:e.siteKey,title:e.siteTitle},timestamp:e.entryContentTime}))}async getContent(e){let t=await this.getWorker(this.config,this.basePath),s=await t.db.query("select title, content, url, siteKey, siteTitle, contentTime as timestamp from Entries where key = ?",[e]);return 0===s.length?null:s[0]}constructor(e){this.worker=null,this.config={from:"inline",config:{serverMode:"full",requestChunkSize:4096,url:"".concat(e,"/data.sqlite3")}},this.basePath=e}}var a=s(3454);let l=null,o=e=>(l||(l="files"===a.env.NEXT_PUBLIC_STORAGE?new r(e):new n(e)),l)},2461:function(e,t,s){s.d(t,{BJ:function(){return a},Dq:function(){return i},EH:function(){return n},GJ:function(){return o},hX:function(){return l}}),s(7294);var r=s(6456);let i=e=>"article"===e?"block":"hidden xl:block",n=e=>{switch(e){case"article":return"hidden xl:block";case"entries":return"block";default:return"hidden sm:block"}},a=e=>{switch(e){case"article":return"hidden xl:block";case"entries":return"hidden sm:block";default:return"block"}},l=e=>{let t=e.split("/");if(t.shift(),![2,4].includes(t.length))return null;if(2===t.length){if(!t[1].trim())return null;switch(t[0]){case"categories":return{type:"category",category:t[1]};case"sites":return{type:"site",siteKey:t[1]};default:return null}}return t[3].trim()&&["categories","sites"].includes(t[0])&&"entries"===t[2]?{type:"entry",entryKey:t[3],parent:{type:"categories"===t[0]?"category":"site",key:t[1]}}:null},o=async(e,t,s,i)=>{if(!e)return null;let n=(0,r.c)(t);switch(e.type){case"category":case"site":s(null),i("entries");return;case"entry":{let{entryKey:t}=e,r=await n.getContent(t);if(!r)return;s(r),i("article");return}}}}}]);