{"title":"chai.js deep equal","link":"https://www.llun.me/posts/dev/2014-01-17-chaijs-deep-equal/","date":1389916800000,"content":"<div id=\"readability-page-1\" class=\"page\"><div><p>เห็น <a href=\"https://twitter.com/visibletrap/status/424001874178473986\" target=\"_blank\" rel=\"noopener\">tweet @visibletrap</a> เลยกระตุ้นให้อยากเขียนเรื่องนี้ขึ้นมาเสียหน่อย เพราะเป็นอะไรที่คล้ายกันมากในโลก Javascript</p><p>Spec framework ที่ผมใช้ตลอดช่วงหลังคือ Mocha แต่มันก็เป็นแค่ตัวรันครอบเท่านั้น Assertion framework ภายในกลับไม่ได้ใช้อะไรของ Mocha เลยแต่เป็น Chai.js ซึ่งมีอะไรให้เล่นเยอะแยะมากมายกว่า แต่วันนี้ขอเขียนถึงแค่ Feature เดียวคือ deep equal เพราะใช้บ่อย</p><p>เวลาทำอะไรใน Javascript สิ่งที่ได้ออกมาส่วนใหญ่ก็จะออกมาเป็น Object หรือ JSON ซึ่งเวลาจะเทียบกันด้วย Assertion framework ปกติคือ เทียบทีละ property</p><pre><code><span>describe</span><span>(</span><span>'Target'</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><br>  <span>describe</span><span>(</span><span>'#doSomething'</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><br>    <span>var</span> result <span>=</span> target<span>.</span><span>doSomething</span><span>(</span><span>)</span><br>    <span>assertEqual</span><span>(</span>result<span>.</span>property1<span>,</span> <span>'expect value1'</span><span>)</span><br>    <span>assertEqual</span><span>(</span>result<span>.</span>property2<span>,</span> <span>'expect value2'</span><span>)</span><br>  <span>}</span><span>)</span><br><span>}</span><span>)</span></code></pre><p>ซึ่งถ้ามี property น้อยๆ หรือ object ไม่ซับซ้อนก็พอไหว แต่ถ้ามี array ซ้อนภายในก็เริ่มจะยุ่งยากหละ Chai.js มีตัวช่วยเรียกว่า deep เพื่อเทียบสิ่งที่อยู่ภายในให้ทั้งหมด จากด้านบนถ้าเทียบด้วย deep ก็จะกลายเป็น</p><pre><code><span>describe</span><span>(</span><span>'Target'</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><br>  <span>describe</span><span>(</span><span>'#doSomething'</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><br>    <span>var</span> result <span>=</span> target<span>.</span><span>doSomething</span><span>(</span><span>)</span><br>    <span>expect</span><span>(</span>result<span>)</span><span>.</span>to<span>.</span>deep<span>.</span><span>equal</span><span>(</span><span>{</span><br>      property1<span>:</span> <span>'expect value1'</span><span>,</span><br>      property2<span>:</span> <span>'expect value2'</span><br>    <span>}</span><span>)</span><br>  <span>}</span><span>)</span><br><span>}</span><span>)</span></code></pre><p>เขียนเทียบน้อยลงและเห็นหน้าตา output ที่ spec เลย! ดีกว่าเยอะ</p></div></div>","author":"","siteTitle":"@llun story","siteHash":"e492a4c5a091b6624e5872d8d003bc73eb1166cc8f88db58c44e1f8dfb9c7252","entryHash":"0f791e2dcc166b0e7e0902ce6818cfdd7019717444645159aa7f57ab3e97fbe2","category":"Me"}