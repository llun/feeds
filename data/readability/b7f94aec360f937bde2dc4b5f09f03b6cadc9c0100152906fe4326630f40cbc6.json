{"title":"function.bind()","link":"https://www.llun.me/posts/dev/2014-04-01-function-bind/","date":1396310400000,"content":"<div id=\"readability-page-1\" class=\"page\"><div><p>ใน Javascript arguments สามารถส่ง function เข้าไปได้ซึ่งก็เป็นที่นิยมในการใช้งานโดยเฉพาะใน Node.js ตัวอย่างแบบง่ายสุดก็คงเป็น setTimeout</p><pre><code><span>setTimeout</span><span>(</span><span>function</span> <span>(</span><span>)</span> <span>{</span><br>  <span>doSomething</span><span>(</span><span>)</span><br><span>}</span><span>,</span> <span>1000</span><span>)</span></code></pre><p>function ที่ส่งเข้าไปก็จะถูกเรียกโดย function อื่นอีกทีนึง อาจมี arguments จาก function หลักหรือข้อมูลจากภายนอกเข้าไปก็ได้ การส่งข้อมูลจากนอก function หลักทางนึงที่ทำกันคือสร้าง global variable นอก function นั้นแล้วเรียกใช้ใน function ที่ส่งเข้าไปอีกที</p><pre><code><span>var</span> data <span>=</span> <span>0</span><br><span>setTimeout</span><span>(</span><span>function</span> <span>(</span><span>)</span> <span>{</span><br>  <span>doSomethingWith</span><span>(</span>data<span>)</span><br><span>}</span><span>,</span> <span>1000</span><span>)</span></code></pre><p>ปัญหาคือ variable นี้สามารถเปลี่ยนแปลงได้แล้วจะรู้ได้ยังไงว่า function นั้นใช้ค่าที่ถูกต้อง แม้ว่า node.js จะเป็น single thread ก็ตามแต่ถ้าเป็นงานที่เรียกใช้ตัวแปรเดียวกันนี้ตลอด บางครั้งก็อาจได้ค่าที่ผิด javascript ในรุ่นหลังๆ เลยเพิ่ม function เข้ามาใหม่ชื่อว่า bind ที่สามารถกำหนด parameters ให้กับฟังก์ชั่นพร้อมตัวแปร this ซึ่งก็คล้ายๆ กับ call และ apply แต่ bind ไม่ได้เรียก function เพียงแต่สร้าง function มาครอบทับอีกที arguments ทั้งหลายเหมือน call เช่น</p><pre><code><span>setTimeout</span><span>(</span><br>  <span>function</span> <span>(</span><span>data</span><span>)</span> <span>{</span><br>    <span>doSomething</span><span>(</span>data<span>)</span><br>  <span>}</span><span>.</span><span>bind</span><span>(</span>caller<span>,</span> <span>'sample'</span><span>)</span><span>,</span><br>  <span>1000</span><br><span>)</span></code></pre><p>parameters ที่ส่งผ่าน bind เข้าไปจะถูกแนบไปด้านหน้าเสมอ เพราะงั้น ถ้า callback มีการรับอะไรเพิ่มเติมก็จะตามหลังจากที่กำหนดใน bind ตัวอย่างเวลาใช้กับ jQuery บ้าง</p><pre><code>jQuery<span>.</span><span>getJSON</span><span>(</span><br>  <span>'http://api.service.io/data.json'</span><span>,</span><br>  <span>function</span> <span>(</span><span>count<span>,</span> data<span>,</span> status</span><span>)</span> <span>{</span><br>    <span>if</span> <span>(</span>count <span>&gt;</span> <span>10</span><span>)</span> <span>{</span><br>      <span>doSomethingWith</span><span>(</span>data<span>)</span><br>    <span>}</span> <span>else</span> <span>{</span><br>      <span>doSomethingElseWith</span><span>(</span>data<span>)</span><br>    <span>}</span><br>  <span>}</span><span>.</span><span>bind</span><span>(</span>count<span>)</span><br><span>)</span></code></pre><p>ใน Node.js ที่ใช้บ่อยสุดก็คงเป็น Q.js เพราะมีการส่ง function เพื่อเรียกต่อๆ กันเยอะมาก แทบจะขาดไม่ได้เลย แต่ไม่ได้สนใจอะไรพิเศษจนต้องมาเขียนบางอย่างที่เอามาใช้คู่กับ apply/call แล้วรู้สึกมันเจ๋งมาก เลยเขียนขึ้นมาเป็น post นี้</p></div></div>","author":"","siteTitle":"@llun story","siteHash":"e492a4c5a091b6624e5872d8d003bc73eb1166cc8f88db58c44e1f8dfb9c7252","entryHash":"b7f94aec360f937bde2dc4b5f09f03b6cadc9c0100152906fe4326630f40cbc6","category":"Me"}