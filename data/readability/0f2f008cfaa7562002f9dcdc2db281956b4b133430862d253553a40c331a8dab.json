{"title":"Logging in PHP","link":"https://www.llun.me/posts/dev/2014-03-07-logging-in-php/","date":1394150400000,"content":"<div id=\"readability-page-1\" class=\"page\"><div><p>ช่วงนี้ต้องทำงานกับ PHP ปัญหาอย่างนึงที่เจอคือต้องการดูผลลัพธ์บางอย่าง ถ้าเป็นแต่ก่อนก็คงให้พิมพ์ออกมาในหน้าเว็บตรงๆ แต่นี่มันปี 2014 ที่ javascript มี console.log แล้ว PHP ก็น่าจะมีเหมือนกันสิ แล้วก็เจอว่า PHP ก็มีอะไรคล้ายๆ กันจริงด้วยชื่อว่า <code>error_log</code></p><p><code>error_log</code> รับ arguments 4 ค่าเริ่มจาก ข้อความที่จะพิมพ์ลง log, ประเภทข้อความ, ตำแหน่งของ log, ข้อมูลอื่นๆ นอกจากข้อความใน argument แรกแล้วที่เหลือไม่จำเป็นต้องใส่</p><ul><li>ข้อความที่พิมพ์ลง log อันนี้ตรงไปตรงมาไม่มีอะไร</li><li>ประเภทข้อความ มีด้วยกัน 5 ประเภท</li><li>0, default option ลง web server log หรือไฟล์แล้วแต่ตั้งค่ากับวิธีการเรียก</li><li>1, ส่งเข้า email ตามที่กำหนดใน ตำแหน่ง log (argument ที่ 3)</li><li>2, ไม่ถูกใช้แล้ว</li><li>3, append เข้าไฟล์ใน argument ที่ 3</li><li>4, ยิงเข้า SAPI Logging</li><li>ตำแหน่งที่จะเก็บ log เป็นได้ทั้ง email หรือ file</li><li>extra header สำหรับแนบไปกับ email ถูกเอามาใช้เมื่อกำหนดให้ส่งเข้าเมล์เท่านั้น</li></ul><p>เวลาใช้ปกติก็ส่งเข้า <code>error_log</code> ตรงๆ <code>error_log('message');</code> หรือ <code>error_log($variable);</code> แต่บางครั้งไม่อยากเห็น debug message ปนกับข้อความอื่นของ server ก็กำหนดหน่อยให้มันลงแยก <code>error_log('message', 3, '/var/log/debug.php.logs');</code></p><p>แต่บางครั้ง log แค่ message ไม่พออยาก dump variable ออกมาดูด้วยว่าหน้าตาเป็นยังไงก็มี function ช่วยอีกอัน <code>print_r</code> ที่สามารถกำหนดได้ว่าให้ return หน้าตาของตัวแปรออกไป ใช้คู่กับ <code>error_log</code> ก็จะได้เห็นหน้าตาของตัวแปรใน log file ที่ต้องการ <code>error_log(print_r($variable, true));</code></p><p>แต่ๆ เท่านั้นยังไม่พอ บางทีอยากเห็น stack trace ด้วยเพื่อไล่การทำงานของ function ถูกก็มี function <code>debug_backtrace</code> เวลาใช้ส่วนใหญ่จะใช้ในแบบ code ด้านล่าง (จริงๆ มันรับ argument เพื่อกำหนดขอบเขตของ output ด้วยแต่ไปๆ มาพิมพ์เองนี่แหละง่ายกว่า)</p><pre><code><span>$trace</span> <span>=</span> <span>debug_backtrace</span><span>(</span><span>)</span><span>;</span><br><span>foreach</span> <span>(</span><span>$trace</span> <span>as</span> <span>$value</span><span>)</span> <span>{</span><br>  <span>$file</span> <span>=</span> <span>$value</span><span>[</span><span>'file'</span><span>]</span><span>;</span><br>  <span>$line</span> <span>=</span> <span>$value</span><span>[</span><span>'line'</span><span>]</span><span>;</span><br>  <span>error_log</span><span>(</span><span>\"<span><span>$file</span></span> <span><span>$line</span></span>\"</span><span>)</span><span>;</span><br><span>}</span></code></pre><p><strong>อ้างอิง:</strong></p><ul><li><a href=\"http://www.php.net/manual/en/function.error-log.php\">PHP: error_log</a></li><li><a href=\"http://www.php.net/print_r\">PHP: print_r</a></li><li><a href=\"http://www.php.net/manual/en/function.debug-backtrace.php\">PHP: debug_backtrace</a></li></ul></div></div>","author":"","siteTitle":"@llun story","siteHash":"e492a4c5a091b6624e5872d8d003bc73eb1166cc8f88db58c44e1f8dfb9c7252","entryHash":"0f2f008cfaa7562002f9dcdc2db281956b4b133430862d253553a40c331a8dab","category":"Me"}