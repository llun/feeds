{"title":"Debian 10 arm64 with qemu","link":"https://www.llun.me/posts/dev/2021-02-16-debian-arm64-in-qemu/","date":1613433600000,"content":"<div id=\"readability-page-1\" class=\"page\"><div><p>วันนี้จะลองแก้ปัญหา docker image ให้เพื่อนบน M1 ก็เลยหาทางเอา docker มารันบน Arm64 แต่ไม่คิดว่าขั้นตอนมันจะเยอะกว่าที่คิด<br>เพราะ VMWare Fusion ที่มีอยู่ไม่พอ ต้องหา emulator มาแปลงอีกที จดที่ตัวเองทำไว้ก่อน เพราะมี step เยอะกว่าที่คิดมาก</p><ol><li>Install qemu, <code>sudo apt-get install qemu-system-arm</code></li><li>Download debian qemu image จาก https://cdimage.debian.org/cdimage/openstack/current/ เลือก image ที่เป็น arm64, qcow2</li><li>Resize image, <code>qemu-img resize debian-10-openstack-arm64.qcow2 +18G</code></li><li>เพิ่ม ssh key เพื่อให้ ssh เข้าไปเล่นได้</li></ol><pre><code>sudo modprobe nbd\nsudo qemu-nbd -c /dev/nbd0 debian-10-openstack-arm64.qcow2\nsudo mount /dev/nbd0p2 /mnt\nsudo mkdir -p /mnt/home/debian/.ssh\nsudo chown -R 1000:1000 /mnt/home/debian\ncat ~/.ssh/id_rsa.pub &gt; /mnt/home/debian/.ssh/authorized_keys\nchmod 600 /mnt/home/debian/.ssh/authorized_keys\nsudo umount /mnt\nsudo qemu-nbd -d /dev/nbd0\n</code></pre><ol start=\"5\"><li>สุดท้ายเรียก qemu รัน image ขึ้นมา</li></ol><pre><code>qemu-system-aarch64 -m 8G -M virt -cpu max \\\n  -bios /usr/share/qemu-efi-aarch64/QEMU_EFI.fd \\\n  -drive if=none,file=debian-10-openstack-arm64.qcow2,id=hd0 -device virtio-blk-device,drive=hd0 \\\n  -device e1000,netdev=net0 -netdev user,id=net0,hostfwd=tcp:127.0.0.1:5555-:22 \\\n  -nographic\n</code></pre></div></div>","author":"","siteTitle":"@llun story","siteHash":"e492a4c5a091b6624e5872d8d003bc73eb1166cc8f88db58c44e1f8dfb9c7252","entryHash":"e5210f1d3459702ba4ae6029a01e96c091a5fdbb7f1fe7b4738b8512dc7826a2","category":"Me"}