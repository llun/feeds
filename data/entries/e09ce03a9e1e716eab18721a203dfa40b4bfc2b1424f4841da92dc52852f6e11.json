{"title":"Designing bus service route diagrams on BusRouter SG","link":"https://cheeaun.com/blog/2021/09/bus-service-route-diagrams-busrouter-sg/","date":1632096000000,"content":"<p>I launched the all-new design for <a href=\"https://busrouter.sg/\">BusRouter SG</a> on <a href=\"https://twitter.com/cheeaun/status/1064344313549574144\">November 2018</a>. I <a href=\"/blog/2019/02/building-busrouter-sg/\">wrote about my journey</a> that lead me to the current design and quoted:</p><blockquote>\n<p><strong>Redesign the whole UI</strong> to be more map-focused and mobile-optimized.</p>\n<ul>\n<li>Getting rid of the list view, especially the list of stops for a bus service. Despite its usefulness, I realised that most users don‚Äôt care about the bus stop numbers and names.</li>\n<li>Putting more focus on the search field as I expect most users have a bus service in mind and won‚Äôt be <em>browsing</em> for bus services.</li>\n<li>The map should take the full spotlight, by hiding any unnecessary information, and let users focus on the map data.</li>\n</ul>\n</blockquote><p>The first point, for getting rid of the list of stops, was actually a huge deal.</p><p>Most web sites and apps usually show two views; map view and list view. The former is great for visually identifying the <em>real</em> geographical locations, while the latter is more readable and scannable.</p><p>The <strong>previous design</strong>, showing map view <em>and</em> list view:</p><figure><img src=\"/blog/images/screenshots/web/busrouter-sg-old-map-view-list-view@2x.png\" alt=\"Previous design of BusRouter SG, with map view and list view\" width=\"800\" height=\"600\" loading=\"lazy\" /></figure><p>The <strong>current design</strong> (2018-2020), with <em>only</em> the map view:</p><figure><img src=\"/blog/images/screenshots/web/busrouter-sg-map-view@2x.png\" alt=\"Current design of BusRouter SG (2018-2020) with only the map view\" width=\"800\" height=\"600\" loading=\"lazy\" /></figure><p>At that time, my thinking is that the list view is useless, as I suspect most people don‚Äôt remember stop numbers and even the stop names. The map view is more <em>visual</em> and geographically contextual.</p><p>Removing the list view was a huge bet. But after a while I have a hunch that some people may not be as map literate as I am. I suspect that <em>most</em> users of BusRouter SG would be pretty <em>advanced</em> bunch of people who are either passionate about public transports or really knows their way around very well.</p><p>Or... perhaps they're neither? ü§î</p><p>There were two reasons why I remove the list view:</p><ol>\n<li>There‚Äôs <strong>not enough space</strong> to fit both map view and list view on a small-screen device. I‚Äôve struggled with this by making both views use half of the screen real estate. I‚Äôve thought of making it toggle between views, showing one view at a time, though it would make it difficult to <em>link</em> both views visually.</li>\n<li>Some bus services <strong>have two route patterns</strong>, usually to and fro. The old design, including all other sites and apps, render them in tabs which the user has to toggle. So the user can only view <em>one</em> route pattern at a time on the list view, but they can see <em>both</em> patterns on the map view. Though some sites and apps opt to show one of the patterns on the map too.\n<figure><img src=\"/blog/images/screenshots/web/busrouter-sg-old-one-service-two-routes-tabs.gif\" alt=\"The old BusRouter SG, showing one service and two routes tab\" width=\"480\" height=\"411\" loading=\"lazy\" /></figure></li>\n</ol><p>Over the years, I‚Äôve rethought about these reasons.</p><ol>\n<li>Phones are getting bigger, so there should be more space now for both map view and list view. I know that smaller-screen devices still exist but I did a cost-benefit analysis and think scrolling down a list is <em>still</em> easier than zooming in/out and panning on a map.</li>\n<li>Showing one route pattern at a time is not ideal. Showing both takes up a lot space. I need to think of a much better solution for this.</li>\n</ol><h2>The beginning</h2><p>On <a href=\"https://twitter.com/cheeaun/status/1397539071895883782\">May 2021</a>, I took <strong>a small step forward</strong> into designing and coding one of the <strong>coolest bus service route diagrams I‚Äôve ever seen</strong>.</p><p><em>First</em> iteration looks like this:</p><figure><img src=\"/blog/images/screenshots/web/bus-service-route-diagram-iteration-1@2x.jpg\" alt=\"Bus service route diagram, first iteration\" width=\"320\" height=\"568\" /></figure><ul>\n<li>Both route patterns are side-by-side taking half of the vertical space (two columns).</li>\n<li>Stops are rendered as red circles, with red lines in between.</li>\n<li>Stop numbers and names are rendered too. Names are not truncated so they could wrap up to 2 or 3 lines.</li>\n<li>This was initially done with <a href=\"https://developer.mozilla.org/en-US/docs/Learn/CSS/CSS_layout/Flexbox\">Flexbox</a> and every stop row will grow to accommodate space until the last stop at the bottom.</li>\n</ul><p>For this route, the data looks roughly like this:</p><ol>\n<li>Ang Mo Kio Int ‚Üí ‚Ä¶ ‚Üí Shenton Way Ter</li>\n<li>Shenton Way Ter ‚Üí ‚Ä¶ ‚Üí Ang Mo Kio Int</li>\n</ol><p>For this iteration, the second (right) column is <strong>purposely reversed</strong> so that the first stop of the first route pattern is positioned together with the last stop of the second route pattern.</p><p>But here‚Äôs the problem, how would the users know that?</p><p><em>Second</em> iteration <a href=\"https://twitter.com/cheeaun/status/1397546051674906624\">fixes the problem</a>:</p><figure><img src=\"/blog/images/screenshots/web/bus-service-route-diagram-iteration-2@2x.jpg\" alt=\"Bus service route diagram, second iteration\" width=\"320\" height=\"568\" /></figure><ul>\n<li>Arrows are added to indicate the direction of the route patterns.</li>\n<li>They are not placed after every single stop, but decently spaced out to prevent clutter.</li>\n<li>Interestingly, there was a <a href=\"https://twitter.com/jg_lim/status/1397546621735342080\">feedback</a> that they look like approximate real-time locations of buses on the routes ü§î.</li>\n</ul><p>Looking at this, it feels like my job is done.</p><p>But I got curious. For a long time, I have this idea of linking the stops from the opposite route patterns.</p><p>For example:</p><figure><img src=\"/blog/images/screenshots/web/bus-stops-opposite@2x.jpg\" alt=\"Bus stops opposite each other, possibly walkable via pedestrian crossing\" width=\"500\" height=\"300\" /></figure><p>Bus stop ‚ÄúBlk 140‚Äù (10061) is geographically opposite of ‚ÄúOpp Blk 140‚Äù (10069). They are walkable via the pedestrian crossing. There‚Äôs also a possibility that they serve the same bus services, which is useful if someone accidentally took the wrong side or overshoot their journey, they know the opposite stop should serve the same services of the opposite direction üòâ.</p><p>To know the \"opposite states\" of the stops would be a difficult task as they are many kinds of roads and I wouldn‚Äôt know if they really serve the same services or even walkable in between. I probably could go though all stops, determine their distances, figure out the services that go through each stop, and generate a whole set of data? Sounds like a lot of work üòÖ.</p><p>Fortunately, thanks to <a href=\"https://landtransportguru.net/\">Land Transport Guru</a>, a website made by a few awesome transport enthusiasts, I found <a href=\"https://landtransportguru.net/bus-stops/\">this gem</a>:</p><blockquote>\n<p>Most bus stops end with the digit ‚Äò1‚Äô or ‚Äò9‚Äô. The last digit is used to differentiate the direction of the services. If it ends with ‚Äò1‚Äô for a service travelling from A to B, the pairing of this bus stop across the road for direction B to A will have a bus stop number ending with ‚Äò9‚Äô.</p>\n</blockquote><p>This <em>really</em> makes thing easier.</p><p>I <a href=\"https://twitter.com/cheeaun/status/1397901070697783296\">made a quick hack</a> on the rows and columns and came up with these:</p><figure><img src=\"/blog/images/screenshots/web/bus-service-route-diagram-iteration-3@2x.jpg\" alt=\"Bus service route diagram, third iteration #1\" width=\"320\" height=\"568\" /></figure><figure><img src=\"/blog/images/screenshots/web/bus-service-route-diagram-iteration-4@2x.jpg\" alt=\"Bus service route diagram, third iteration #2\" width=\"320\" height=\"568\" /></figure><figure><img src=\"/blog/images/screenshots/web/bus-service-route-diagram-iteration-5@2x.jpg\" alt=\"Bus service route diagram, third iteration #3\" width=\"320\" height=\"568\" /></figure><figure><img src=\"/blog/images/screenshots/web/bus-service-route-diagram-iteration-6@2x.jpg\" alt=\"Bus service route diagram, third iteration #4\" width=\"320\" height=\"568\" /></figure><ul>\n<li>Blue dots in between opposite stops. <em>Feels</em> like walking routes.</li>\n<li>The opposite stops affect the <em>whole</em> layout and stretch the lines vertically, as if there are magnets between the opposite stops.</li>\n<li>The arrows become slightly opaque, serving as a more subtle hint for the directions.</li>\n<li>The stops that are at the top and bottom of the list (first stop of first route with last stop of second route, and last stop of first route with first stop of second route) will be combined into a single stop if they are the same stop. This makes the line looks continuous and closed-loop if the route pattern is A ‚Üí B and B ‚Üí A.</li>\n</ul><p>For this kind of layout, I have to use <code>&lt;table&gt;</code>s instead of Flexbox. The height of every stop cell changes based on the length of the stop name and the linked opposite stops affecting the sibling stops. To <em>stretch</em> some of the cells, I have to tweak and calculate the <code>rowspan</code> to ‚Äúpush‚Äù the cells down.</p><p>In other words, it‚Äôs <strong>a lot of math</strong>. üòµ‚Äçüí´</p><p>I made a few more changes and experimented on how the interactions would look like:</p><figure></figure><ul>\n<li>Bus stop numbers have changed from white text on red background to just red text. They don‚Äôt need to be so eye-catchy and now it looks more consistent with the map marker labels.</li>\n<li>Map view takes top half of the screen viewport while the list view takes the bottom half. Seems‚Ä¶ okay.</li>\n<li>Tapping on a stop in the list will zoom to the stop on the map. Tapping it the second time will open the stop popover.</li>\n<li>A legend is added at the bottom of the diagram to explain what the blue dots mean.</li>\n</ul><h2>The testing</h2><p><a href=\"https://twitter.com/cheeaun/status/1398643394138677262\">Basically</a>, there are 4 <em>main</em> types of route patterns.</p><figure><img src=\"/blog/images/figures/diagram/bus-service-route-diagrams-4-types.png\" alt=\"Bus service route diagrams, 4 types of route patterns; A to B, A to B and B to A, A to A, and A to B and C to D\" width=\"1740\" height=\"3280\" loading=\"lazy\" /></figure><p>Notice that for A ‚Üí B (one-way route), the diagram is simply a list, with red line on the left side instead of center.</p><p>At this point, I feel like my job is done (again?), <em>but</em> still not feeling confident enough to see if the diagram layout logic would work for <strong>every</strong> single use-case. There could be A ‚Üí B + B ‚Üí C route? What if the first stop of first route pattern is opposite of the 2nd last stop of the 2nd route pattern? What if the route pattern has only 2 stops and also a loop route?</p><p>Okay fine, I <a href=\"https://twitter.com/cheeaun/status/1398944388395409410\">wrote tests</a>!</p><figure><img src=\"/blog/images/figures/diagram/bus-service-route-diagrams-tests.png\" alt=\"Bus service route diagrams tests\" width=\"2880\" height=\"2868\" /></figure><p>I try to <em>simulate</em> as many (weird) use-cases as possible and fix the bugs as I find them. This test suite is not quite a <em>real</em> test suite. There are no test frameworks and I‚Äôm basically eyeballing for bugs or unexpected cases ü§£.</p><p>I feel that this is <em>still</em> not enough, and decided to <a href=\"https://twitter.com/cheeaun/status/1399035542147264516\">go the extra mile</a> and render <strong>all 500+ bus routes</strong>. ü§Ø</p><figure></figure><p>By doing this, I manage to find <em>even more</em> bugs (duh).</p><p><a href=\"https://twitter.com/cheeaun/status/1399378847498342405\">For</a> <a href=\"https://twitter.com/cheeaun/status/1399378847498342405\">example</a>, bus service ‚Äò<strong>307</strong>‚Äô:</p><figure><img src=\"/blog/images/screenshots/web/bus-service-307-route-wrap@2x.jpg\" alt=\"Bus service 307; two versions of its route\" width=\"512\" height=\"1156\" /></figure><p>The diagram above shows two versions; left is the initial implementation, right is the final best-effort ‚Äúbottom-wrapped‚Äù fixed version.</p><p>This bus service is one of the cases where this kind of layout is not suitable. ‚ÄúChua Chu Kang Int‚Äù (44009) has to be at the top of the list so that the user can see where the bus starts departing. But in reality, the route on the map looks like this:</p><figure><img src=\"/blog/images/screenshots/web/bus-service-307-map-busrouter-sg@2x.jpg\" alt=\"Bus service 307‚Äôs route on the map\" width=\"455\" height=\"628\" loading=\"lazy\" /></figure><p>‚ÄúChua Chu Kang Int‚Äù is right in the <strong>middle</strong> of the route loop, with <em>most</em> of the other stops being opposite to one another.</p><p>The bus stops that require some attention here is ‚Äò44461‚Äô opposite to ‚Äò44469‚Äô. In the above route diagram for service ‚Äò307‚Äô, there‚Äôs no way that they can laid out opposite each other. All the bus stops at the top section can‚Äôt be grouped together, but at least the stops at the bottom section can be ‚Äúwrapped‚Äù around (best-effort fix).</p><p>I‚Äôve thought about this. Here are some sketches that could possibly fix this and make it contextually similar to their geographical locations.</p><figure><img src=\"/blog/images/figures/diagram/bus-service-307-route-fixes-contextual-geographical-locations.jpg\" alt=\"Sketches of bus service 307‚Äôs route fixes with better contextual and geographical locations\" width=\"781\" height=\"1024\" /></figure><p>There are 3 sketches.</p><ul>\n<li>The <strong>first sketch</strong> is the most logical layout but it takes up more horizontal space which doesn‚Äôt match the vertical layout here. It will also be more difficult to place the stop numbers and names along the stop circles. üò´</li>\n<li>The <strong>second sketch</strong> shifts the starting stop to the left-side middle of the list. The layout stays the same in vertical mode but now the starting stop is no longer the first at-the-top thing that the user see, which may cause some confusion. ü§®</li>\n<li>The <strong>third sketch</strong> is a weird combination of both, trying to maintain the vertical layout mode while trying to keep the starting stop at the top. Obviously, it‚Äôs impossible to fit so many things in such a tight space. Two columns of stop numbers and names is already quite a challenge, and this is like four columns? üòÖ</li>\n</ul><p>I didn‚Äôt implement any of these sketches. None of them are perfect yet.</p><p>So for now, service ‚Äò307‚Äô ended up with the above-shown best-effort version, with ‚Äúbottom-wrapped‚Äù stops.</p><p>Okay, let‚Äôs move on to another <a href=\"https://twitter.com/cheeaun/status/1399739597425233920\">example</a>, bus service ‚Äò<strong>410</strong>‚Äô:</p><figure><img src=\"/blog/images/screenshots/web/bus-service-410-route@2x.jpg\" alt=\"Bus service 410 route\" width=\"260\" height=\"1024\" /></figure><p>Looking at this diagram carefully, there are <strong>two</strong> ‚ÄúBishan Int‚Äù stops and‚Ä¶ they‚Äôre actually the same place (53009)! This is rendered like a A ‚Üí B ‚Üí A route but it‚Äôs actually A ‚Üí A ‚Üí A. üòµ‚Äçüí´</p><p>It has two route patterns. Both goes to the same stop so that makes it a loop route. This means service ‚Äò410‚Äô has two one-way loop routes! ü§Ø (I‚Äôm not sure if I‚Äôm making any sense here)</p><p>It‚Äôs <em>really</em> difficult to explain this. The route on the map looks like this:</p><figure><img src=\"/blog/images/screenshots/web/bus-service-410-map-busrouter-sg@2x.jpg\" alt=\"Bus service 410‚Äôs route on the map\" width=\"751\" height=\"500\" loading=\"lazy\" /></figure><p>For the first route pattern, the bus goes anti-clockwise starting from ‚ÄúBishan Int‚Äù and end up back to the same stop itself. Then for the second pattern, the bus goes clockwise.</p><p>Some might think that this should have been two separate bus services, right? üòè</p><p>The geographically-correct route diagram should have been like this:</p><figure><img src=\"/blog/images/figures/diagram/bus-service-410-route-fixes-contextual-geographical-locations.jpg\" alt=\"Sketch of bus service 410‚Äôs route fixes with better contextual and geographical stop locations\" width=\"800\" height=\"1407\" /></figure><p>Sigh, yet another impossible 4-column layout? I can‚Äôt think of any other ways to represent these route patterns.</p><p>I decided to keep this in the backlog and maybe come up with a solution next time. So, service ‚Äò410‚Äô is left untouched. üôè</p><p>Anyway, I continued rendering all 500+ services and fixing all the weird routes. Things start to <a href=\"https://twitter.com/cheeaun/status/1399388155627786243\">look pretty good</a>.</p><figure><img src=\"/blog/images/screenshots/web/500-bus-routes-singapore-1@2x.jpg\" alt=\"500+ bus routes rendered #1\" width=\"1432\" height=\"688\" loading=\"lazy\" /></figure><p>I‚Äôve updated the pagination.</p><figure><img src=\"/blog/images/screenshots/web/500-bus-routes-singapore-2@2x.jpg\" alt=\"500+ bus routes rendered #2\" width=\"1428\" height=\"702\" loading=\"lazy\" /></figure><p>Added bus service names too besides the bus number.</p><figure><img src=\"/blog/images/screenshots/web/500-bus-routes-singapore-3@2x.jpg\" alt=\"500+ bus routes rendered #3\" width=\"1431\" height=\"707\" loading=\"lazy\" /></figure><p>A few more <em>weird</em> bus routes like ‚Äò811‚Äô and ‚Äò912‚Äô.</p><p>And‚Ä¶ not forgetting bus service ‚Äò902‚Äô, the shortest bus route ever in Singapore.</p><figure><img src=\"/blog/images/screenshots/web/bus-service-902-route@2x.png\" alt=\"Bus service 902‚Äôs route, with only two stops\" width=\"382\" height=\"262\" /></figure><h2>The launch</h2><p>On <a href=\"https://twitter.com/cheeaun/status/1401895481467228161\">7 June 2021</a>, I launched the all-new bus routes diagram on <a href=\"https://busrouter.sg/\">BusRouter SG</a>, with a little bit of <a href=\"https://twitter.com/cheeaun/status/1401406847479812097\">redesign</a>. üöÄ</p><figure><img src=\"/blog/images/screenshots/web/busrouter-sg-website-bus-service-route-diagram-133@2x.jpg\" alt=\"BusRouter SG web site showing the bus service route diagram, for bus service 133\" width=\"1024\" height=\"768\" loading=\"lazy\" /></figure><p>I also made a little introductory video and <a href=\"https://www.reddit.com/r/singapore/comments/nv03xe/ive_designed_a_pretty_unique_bus_service_route/\">posted it on /r/singapore</a>.</p><figure><a href=\"https://www.reddit.com/r/singapore/comments/nv03xe/ive_designed_a_pretty_unique_bus_service_route/\"><img src=\"/blog/images/screenshots/web/reddit-designed-unique-bus-service-route-diagram-busrouter-sg@2x.jpg\" alt=\"Reddit post on /r/singapore, titled ‚ÄúI‚Äôve designed a pretty unique bus route diagram on bus router.sg‚Äù\" width=\"480\" height=\"640\" /></a></figure><p>Feedback from the Reddit folks have been surprisingly positive, which I think is more related to the whole app itself instead of the route diagrams üòÖ. It‚Äôs pretty obvious that there are still a lot of people who don‚Äôt know the existence of my app, as I don‚Äôt do any marketing work for it.</p><p>Nevertheless, positive feedback is always good and this experiment has been a lot of fun for me. I‚Äôm still not sure if this work will be useful for anyone, however I do felt <strong>relieved</strong>, like a weight has been lifted off my shoulders. An idea that has been stuck in my mind for so long, is now actualised. Despite not 100% perfect yet, at least it‚Äôs out for public consumption.</p>","author":"Lim Chee Aun","siteTitle":"cheeaunblog","siteHash":"15c7c44e2960b5b47196ecb9d24e84a8cf386d0c7c30998ce31cc3eee11d971a","entryHash":"e09ce03a9e1e716eab18721a203dfa40b4bfc2b1424f4841da92dc52852f6e11","category":"Category2"}