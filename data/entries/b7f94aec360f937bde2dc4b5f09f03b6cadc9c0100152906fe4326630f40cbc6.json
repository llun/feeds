{"title":"function.bind()","link":"https://www.llun.me/posts/dev/2014-04-01-function-bind/","date":1396310400000,"content":"\n      \n        <p>ใน Javascript arguments สามารถส่ง function เข้าไปได้ซึ่งก็เป็นที่นิยมในการใช้งานโดยเฉพาะใน Node.js ตัวอย่างแบบง่ายสุดก็คงเป็น setTimeout</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><br />  <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><br /><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></code></pre>\n<p>function ที่ส่งเข้าไปก็จะถูกเรียกโดย function อื่นอีกทีนึง อาจมี arguments จาก function หลักหรือข้อมูลจากภายนอกเข้าไปก็ได้ การส่งข้อมูลจากนอก function หลักทางนึงที่ทำกันคือสร้าง global variable นอก function นั้นแล้วเรียกใช้ใน function ที่ส่งเข้าไปอีกที</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token number\">0</span><br /><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><br />  <span class=\"token function\">doSomethingWith</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><br /><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></code></pre>\n<p>ปัญหาคือ variable นี้สามารถเปลี่ยนแปลงได้แล้วจะรู้ได้ยังไงว่า function นั้นใช้ค่าที่ถูกต้อง แม้ว่า node.js จะเป็น single thread ก็ตามแต่ถ้าเป็นงานที่เรียกใช้ตัวแปรเดียวกันนี้ตลอด บางครั้งก็อาจได้ค่าที่ผิด javascript ในรุ่นหลังๆ เลยเพิ่ม function เข้ามาใหม่ชื่อว่า bind ที่สามารถกำหนด parameters ให้กับฟังก์ชั่นพร้อมตัวแปร this ซึ่งก็คล้ายๆ กับ call และ apply แต่ bind ไม่ได้เรียก function เพียงแต่สร้าง function มาครอบทับอีกที arguments ทั้งหลายเหมือน call เช่น</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><br />  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><br />    <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><br />  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>caller<span class=\"token punctuation\">,</span> <span class=\"token string\">'sample'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br />  <span class=\"token number\">1000</span><br /><span class=\"token punctuation\">)</span></code></pre>\n<p>parameters ที่ส่งผ่าน bind เข้าไปจะถูกแนบไปด้านหน้าเสมอ เพราะงั้น ถ้า callback มีการรับอะไรเพิ่มเติมก็จะตามหลังจากที่กำหนดใน bind ตัวอย่างเวลาใช้กับ jQuery บ้าง</p>\n<pre class=\"language-js\"><code class=\"language-js\">jQuery<span class=\"token punctuation\">.</span><span class=\"token function\">getJSON</span><span class=\"token punctuation\">(</span><br />  <span class=\"token string\">'http://api.service.io/data.json'</span><span class=\"token punctuation\">,</span><br />  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">count<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> status</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><br />    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">></span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><br />      <span class=\"token function\">doSomethingWith</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><br />    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span><br />      <span class=\"token function\">doSomethingElseWith</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><br />    <span class=\"token punctuation\">}</span><br />  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><br /><span class=\"token punctuation\">)</span></code></pre>\n<p>ใน Node.js ที่ใช้บ่อยสุดก็คงเป็น Q.js เพราะมีการส่ง function เพื่อเรียกต่อๆ กันเยอะมาก แทบจะขาดไม่ได้เลย แต่ไม่ได้สนใจอะไรพิเศษจนต้องมาเขียนบางอย่างที่เอามาใช้คู่กับ apply/call แล้วรู้สึกมันเจ๋งมาก เลยเขียนขึ้นมาเป็น post นี้</p>\n\n        <p>\n          <a href=\"mailto:comment@llun.me?subject=Common on post https://www.llun.me/posts/dev/2014-04-01-function-bind/\">Send a comment</a>\n        </p>\n      \n    ","author":"","siteTitle":"@llun story","siteHash":"e492a4c5a091b6624e5872d8d003bc73eb1166cc8f88db58c44e1f8dfb9c7252","entryHash":"b7f94aec360f937bde2dc4b5f09f03b6cadc9c0100152906fe4326630f40cbc6","category":"Me"}